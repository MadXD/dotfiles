#!/bin/bash
#
# The original idea (and a couple settings) were grabbed from:
#
# - https://github.com/holman/dotfiles/blob/master/osx/set-defaults.sh
# - https://github.com/mathiasbynens/dotfiles/blob/master/.osx
#

set -e
set -u
set -x

#
# Globals
#

# Enable subpixel font rendering on non-Apple LCDs
defaults write NSGlobalDomain AppleFontSmoothing -int 2

# Show scrollbars only when scrolling (i.e.: don't show them when a mouse is connected)
defaults write NSGlobalDomain AppleShowScrollBars -string "WhenScrolling"

# Enable full keyboard access for all controls (e.g. enable Tab in modal dialogs)
defaults write NSGlobalDomain AppleKeyboardUIMode -int 3

# Short "Delay until repeat" and faster "Key Repeat"
defaults write NSGlobalDomain InitialKeyRepeat -int 25
defaults write NSGlobalDomain KeyRepeat -int 2

# Expand save panel by default
defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode -bool true
defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode2 -bool true

# Disable automatic correction
defaults write NSGlobalDomain NSAutomaticSpellingCorrectionEnabled -bool false
defaults write NSGlobalDomain WebAutomaticSpellingCorrectionEnabled -bool false

#
# Globals: Key Remapping
#
# I switch frequently between different operating systems and OS X is the only one with a different
# layout for modifier keys. OS X looses the war and gets its keys remapped.
#
# Since Command is equivalent to the Ctrl key it get remapped so that fingers are in the same
# position regardless of whether I'm using Linux, OS X or Windows.
#

# Apple Internal Keyboard (Vendor ID: 1452 - Product ID: 602)
defaults write NSGlobalDomain     "com.apple.keyboard.modifiermapping.1452-602-0" "(
    { HIDKeyboardModifierMappingDst = 4;  HIDKeyboardModifierMappingSrc = 0;  },
    { HIDKeyboardModifierMappingDst = 4;  HIDKeyboardModifierMappingSrc = 2;  },
    { HIDKeyboardModifierMappingDst = 2;  HIDKeyboardModifierMappingSrc = 3;  },
    { HIDKeyboardModifierMappingDst = 10; HIDKeyboardModifierMappingSrc = 11; },
    { HIDKeyboardModifierMappingDst = 3;  HIDKeyboardModifierMappingSrc = 4;  },
    { HIDKeyboardModifierMappingDst = 11; HIDKeyboardModifierMappingSrc = 12; })"

# Unicomp EnduraPro (Vendor ID: 2873 - Product ID: 1)
defaults write NSGlobalDomain com.apple.keyboard.modifiermapping.2873-1-0 "(
    { HIDKeyboardModifierMappingDst = 4;  HIDKeyboardModifierMappingSrc = 0;  },
    { HIDKeyboardModifierMappingDst = 4;  HIDKeyboardModifierMappingSrc = 2;  },
    { HIDKeyboardModifierMappingDst = 12; HIDKeyboardModifierMappingSrc = 10; },
    { HIDKeyboardModifierMappingDst = 2;  HIDKeyboardModifierMappingSrc = 4;  },
    { HIDKeyboardModifierMappingDst = 10; HIDKeyboardModifierMappingSrc = 12; })"

#
# Dashboard
#

# Disable the Dashboard (need to restart the dock with 'killall Dock')
defaults write com.apple.dashboard mcx-disabled -boolean true

#
# Finder
#

# Disable "Foo is an application downloaded from the Internet" dialog.
defaults write com.apple.LaunchServices LSQuarantine -bool false

# Disable disk image verification
defaults write com.apple.frameworks.diskimages skip-verify -bool true
defaults write com.apple.frameworks.diskimages skip-verify-locked -bool true
defaults write com.apple.frameworks.diskimages skip-verify-remote -bool true

# Automatically open a new Finder window when a volume is mounted
defaults write com.apple.frameworks.diskimages auto-open-ro-root -bool true
defaults write com.apple.frameworks.diskimages auto-open-rw-root -bool true

# Avoid creating .DS_Store files on network volumes
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true

# Use AirDrop over every interface. This should be the default.
defaults write com.apple.NetworkBrowser BrowseAllInterfaces 1

# Always open everything in Finder's column view.
defaults write com.apple.Finder FXPreferredViewStyle clmv

# Finder: show status bar
defaults write com.apple.finder ShowStatusBar -bool true

# Finder: show path bar
defaults write com.apple.finder ShowPathbar -bool true

# Show the ~/Library folder.
chflags nohidden ~/Library

#
# iTerm
#

# Donâ€™t display the annoying prompt when quitting iTerm
defaults write com.googlecode.iterm2 PromptOnQuit -bool false

#
# Safari
#

# Hide Safari's bookmark bar.
defaults write com.apple.Safari ShowFavoritesBar -bool false

#
# System Sound
#

# Disable system sounds
defaults write com.apple.systemsound com.apple.sound.uiaudio.enabled -int 0

#
# Launchpad
#

# Reset Launchpad
find ~/Library/Application\ Support/Dock -name "*.db" -maxdepth 1 -delete

# Add iOS Simulator to Launchpad
ln -sf '/Applications/Xcode.app/Contents/Applications/iPhone Simulator.app' "${HOME}/Applications/"
