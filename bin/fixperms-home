#!/usr/bin/env python2.7

import os
import os.path


def main():
    if not "HOME" in os.environ:
        raise EnvironmentError("Missing HOME environment variable.")

    os.path.walk(os.environ["HOME"], visit, None)


def visit(_, directory, files):
    for path in [os.path.join(directory, f) for f in files]:
        try:
            if os.path.isdir(path):
                os.chmod(path, 0700)
            elif os.path.isfile(path):
                if path.endswith('.DS_Store'):
                    os.remove(path)
                elif os.access(path, os.X_OK):
                    os.chmod(path, 0700)
                else:
                    os.chmod(path, 0600)
        except OSError as e:
            pass


if __name__ == '__main__':
    main()
