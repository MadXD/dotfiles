#!/bin/bash

set -e
set -u

RELEASE="$(lsb_release -cs)"

#
# Repositories
#

echo "
deb http://ch.archive.ubuntu.com/ubuntu/ ${RELEASE} main restricted universe multiverse
deb http://ch.archive.ubuntu.com/ubuntu/ ${RELEASE}-backports main restricted universe multiverse
deb http://ch.archive.ubuntu.com/ubuntu/ ${RELEASE}-proposed main restricted universe multiverse
deb http://ch.archive.ubuntu.com/ubuntu/ ${RELEASE}-security main restricted universe multiverse
deb http://ch.archive.ubuntu.com/ubuntu/ ${RELEASE}-updates main restricted universe multiverse

deb http://archive.canonical.com/ubuntu ${RELEASE} partner
deb http://extras.ubuntu.com/ubuntu ${RELEASE} main
" | sudo tee /etc/apt/sources.list

echo "
Package: *
Pin: release a=${RELEASE}*
Pin-Priority: 9990
" | sudo tee /etc/apt/preferences

if [ "${RELEASE}" = "precise" ]; then
    sudo apt-add-repository -y ppa:chris-lea/node.js
    sudo apt-add-repository -y ppa:fish-shell/release-2
    sudo apt-add-repository -y ppa:git-core/ppa
    sudo apt-add-repository -y ppa:lvillani/silversearcher
    sudo apt-add-repository -y ppa:webupd8team/sublime-text-3
fi

#
# Install Packages
#

pkginst() {
    echo "Installing ${@}..."
    sudo apt-get install -qqy ${@}
}

sudo apt-get update
sudo apt-get dist-upgrade -qqy

pkginst aptitude
pkginst bpython
pkginst build-essential
pkginst cmake
pkginst encfs
pkginst fish
pkginst git
pkginst mercurial
pkginst nodejs
pkginst python
pkginst python-dev
pkginst silversearcher-ag
pkginst sublime-text-installer
pkginst subversion
pkginst terminator
pkginst tig

#
# Change default shell
#

chsh -s /usr/bin/fish lvillani
chsh -s /usr/bin/fish root

#
# Cleanup
#

echo "Cleaning up..."

rm -f /etc/apt/*.save
rm -f /etc/apt/sources.list.d/*.save

sudo apt-get autoremove --purge -qqy
