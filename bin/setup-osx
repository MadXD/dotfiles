#!/bin/bash

set -e

#
# Install Homebrew - http://brew.sh
#

test -x "/usr/local/bin/brew" || {
    ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"
}

brew install caskroom/cask/brew-cask

brew tap caskroom/cask
brew tap caskroom/versions
brew tap homebrew/binary
brew tap homebrew/versions

brew update
brew upgrade

brew cask install xquartz  # Some packages below require XQuartz.

#
# Brew: Formulas
#

brew install android-sdk
brew install bzr
brew install emacs --cocoa --srgb
brew install encfs
brew install fish
brew install git
brew install git-extras
brew install go --cross-compile-common
brew install go-app-engine-64
brew install gradle112
brew install meld
brew install mercurial
brew install node
brew install packer
brew install python
brew install ruby
brew install ssh-copy-id
brew install sshfs
brew install subversion
brew install the_silver_searcher

#
# Brew: Casks
#

# brew cask install ax88772  # ASIX AX88772 (used in Hamlet USB-Ethernet dongle)
# brew cask install mcs783x  # ASIX MCS783x (used in StarTech USBDOCK2)
# brew cask install pl2303   # Prolific PL2303 serial to USB converter
brew cask install android-studio
brew cask install appcleaner
brew cask install chromium
brew cask install colors
brew cask install dropbox
brew cask install firefox
brew cask install flash
brew cask install flux
brew cask install handbrake
brew cask install hipchat
brew cask install inkscape
brew cask install skype
brew cask install spotify
brew cask install vagrant
brew cask install vmware-fusion

#
# Time Machine
#

# Disable local snapshots: http://support.apple.com/kb/ht4878
sudo tmutil disablelocal

# Don't backup the whole system. Just user files.
sudo defaults write /Library/Preferences/com.apple.TimeMachine.plist SkipSystemFiles -bool true
sudo defaults write /Library/Preferences/com.apple.TimeMachine.plist SkipPaths "(
    '/Applications',
    '/System',
    '/Users/Shared',
    '~${USER}/.android',
    '~${USER}/.gem',
    '~${USER}/.go',
    '~${USER}/.m2',
    '~${USER}/.npm',
    '~${USER}/.vagrant.d',
    '~${USER}/Documents/Virtual Machines.localized',
    '~${USER}/Downloads',
    '~${USER}/Library/Caches',
    '~${USER}/VirtualBox VMs'
)"

#
# Cleanup
#

brew cleanup
brew cask cleanup
