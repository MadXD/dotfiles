#!/bin/bash

set -e
set -u
set -x

#
# Install Homebrew - http://brew.sh
#

test -x "/usr/local/bin/brew" || {
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
}

brew install caskroom/cask/brew-cask || true

brew tap beeftornado/rmtree
brew tap caskroom/cask
brew tap homebrew/versions

brew update
brew upgrade

#
# Brew: Formulas
#

brew install android-sdk
brew install brew-rmtree
brew install encfs
brew install fish
brew install git-extras
brew install go --cross-compile-common
brew install gradle
brew install graphicsmagick
brew install httpie
brew install ios-sim
brew install lastpass-cli
brew install mercurial
brew install node
brew install rust
brew install ssh-copy-id
brew install sshfs
brew install the_silver_searcher

#
# Brew: Casks
#

brew cask install android-studio
brew cask install ax88772
brew cask install caffeine
brew cask install cargo
brew cask install ccleaner
brew cask install dropbox
brew cask install firefox
brew cask install flash
brew cask install fluid
brew cask install flux
brew cask install google-chrome
brew cask install handbrake
brew cask install hex-fiend
brew cask install hipchat
brew cask install intel-haxm
brew cask install java
brew cask install jdiskreport
brew cask install lastpass-universal
brew cask install mcs783x
brew cask install namechanger
brew cask install packer
brew cask install phpstorm
brew cask install pycharm
brew cask install shortcat
brew cask install sketch
brew cask install skype
brew cask install spotify
brew cask install sublime-text3
brew cask install synergy
brew cask install teamviewer
brew cask install time-out
brew cask install toggldesktop
brew cask install totalterminal
brew cask install transmission
brew cask install usb-overdrive
brew cask install vagrant
brew cask install vmware-fusion
brew cask install webstorm
brew cask install xquartz


#
# Spotlight
#

# Disable Spotlight indexing for any volume that gets mounted and has not yet been indexed before.
# Use `sudo mdutil -i off "/Volumes/foo"` to stop indexing any volume.
sudo defaults write /.Spotlight-V100/VolumeConfiguration Exclusions -array "/Volumes"

sudo killall mds || true
sudo mdutil -i on / || true

#
# Time Machine
#

# Disable local snapshots: http://support.apple.com/kb/ht4878
sudo tmutil disablelocal

# Don't backup the whole system. Just user files.
sudo defaults write /Library/Preferences/com.apple.TimeMachine.plist SkipSystemFiles -bool true
sudo defaults write /Library/Preferences/com.apple.TimeMachine.plist SkipPaths "(
    '/Applications',
    '/System',
    '/Users/Shared',
    '~${USER}/.android',
    '~${USER}/.gem',
    '~${USER}/.go',
    '~${USER}/.m2',
    '~${USER}/.npm',
    '~${USER}/.vagrant.d',
    '~${USER}/Documents/Virtual Machines.localized',
    '~${USER}/Downloads',
    '~${USER}/Library/Caches',
    '~${USER}/VirtualBox VMs'
)"

#
# Cleanup
#

brew cask cleanup
brew cleanup --force -s
brew linkapps
brew prune
